steps:
#steps:
- name: 'node'
  entrypoint: 'npm'
  args: ['install']
- id: 'Docker Build'
  name: gcr.io/cloud-builders/docker
  args: [
    'build', 
    '-t', 
    'us-central1-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY_NAME}/${_SERVICE_NAME}:$SHORT_SHA',
     '-t',
     'us-central1-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY_NAME}/${_SERVICE_NAME}:latest',
     '.'
   ]
- id: 'Push to Google ACR'
  name: gcr.io/cloud-builders/docker
  args: [
    'push', 
    'us-central1-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY_NAME}/${_SERVICE_NAME}:$SHORT_SHA'
  ]

- name: 'gcr.io/cloud-builders/gcloud'
  args:
    - run
    - deploy
    - swift-service
    - --image=${_REGION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY_NAME}/${_SERVICE_NAME}:$SHORT_SHA
    - --port=8080
    - --region=${_REGION}
    - --memory=512Mi
    - --platform=managed
    - --allow-unauthenticated
    - --min-instances=0
    - --max-instances=5
images: [
   'us-central1-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY_NAME}/${_SERVICE_NAME}:$SHORT_SHA'
  ]
